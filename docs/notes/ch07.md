# 第7章 生成器、迭代器和异步编程

## 1 生成器

- 生成器的作用：创建一个可迭代的对象，这种对象被迭代时，将以每次一个的方式提供其包含的元素。
- 对于接收可迭代对象的函数，如min()、max()和sum()，务必向它传递生成器表达式，而不要传递列表推导式，因为这样效率更高，也符合Python语言习惯。

## 2 迭代器

- 通过实现`__iter__`和`__next__`方法，使得对象成为迭代器
- 内置函数`next()`：跳到可迭代对象中的下一个元素处并返回它
- 使用模块`itertools`

## 3 协程

- 协程的理念：让函数能够在给定时点挂起，并在以后恢复执行。
- `close()`：调用该方法，生成器会收到异常`GeneratorExit`，如果这个异常未得到处理，生成器将结束，不再生成其他的值，并停止迭代。
- `throw(ex_type[, ex_value[, ex_traceback]])`：该方法在生成器当前挂起的代码行处引发异常。如果生成器包含与发送的异常匹配的`except`子句，将调用其中的代码，否则异常将传播到调用者。
- `send(value)`：该方法从调用者那里接收值
- `yield from`语法：用于将嵌套`for`循环中的多个生成器串接成一个，得到一个字符串，其中包含生成的所有值

## 4 异步编程

- 好处：能够以非阻断方式并行地执行I/O操作
- 基本原理：使用一个低级生成器，执行在协程被挂起时处理实际的I/O操作。协程通过挂起，让程序能够在此期间处理其他任务。应用程序通过`yield from`来重获控制权，这条语句挂起协程，并给调用者提供一个值。
- Python异步编程原理：基于事件循环，它负责管理一系列协程，这些协程属于事件循环，而事件循环根据其调度机制调用协程。每个协程运行时，都会调用其代码。要将控制权还给事件循环，可调用`await <coroutine>`，这将异步地处理任务。此时，事件循环将重获控制权，并在该操作运行期间启动另一个协程。
- 异步上下文：在用于协程的上下文管理器中，需要实现`__aenter__`和`__aexit__`方法，调用异步上下文管理器时，需要使用`async with`
- 异步迭代：需要实现`__aiter__`和`__anext__`方法