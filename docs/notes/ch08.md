# 第8章 单元测试和重构

## 1 单元测试

- 单元测试的特征：
    1. 隔离：应完全独立于所有外部代理，且必须只关注业务逻辑
    2. 性能：必须快速运行，重复运行多次
    3. 可重现性：必须能够以确定的方式客观地评估软件的状态，测试结果必须是可重现的
    4. 自验证：只需执行单元测试就能知道结果，而无须包含对单元测试进行解读的额外步骤
- 与敏捷软件开发的关系：单元测试犹如安全网，让我们能够放心地去处理代码，测试越出色，我们能够快速提供价值的可能性越大
- 与软件设计的关系：最低层是给代码添加单元测试，最高层是整个设计由测试方式驱动（测试驱动设计）

## 2 测试工具

- `unittest`：基于JUnit的概念，测试是通过类编写的，检查是由方法验证的，并且通常根据类中的场景对测试进行分组。
- `pytest`：可以将不同的测试场景放在不同的类中，并为测试创建面向对象模型，可以直接在简单函数中使用`assert`语句来检查要验证的条件。
- 代码覆盖率：高覆盖率是代码整洁的必要条件，而非充分条件。
- 模拟对象：目的是让测试摆脱不良副作用的影响，使用`unittest.mock.Mock`对象

## 3 其他测试

- 基于属性的测试：为测试用例生成数据，以找出会导致代码失败但以前的单元测试未涵盖的场景，可使用`hypothesis`库
- 变异测试：当有人在代码中引入bug，希望至少有一个测试能捕获它，如果没有任何测试捕获这个bug，就说明要么缺少一个测试，要么既有的测试没有执行正确的检查。
- 常见的测试概念：
  1. 边界值或极值：在检查值区间的条件中，检查区间两端的值
  2. 等价类：集合的一部分，其中每个元素对某个函数来说都是等价的
  3. 边缘情况
- 驱动测试开发（TDD）工作流程（红灯-绿灯-重构）：
  1. 编写一个单元测试，对代码的行为进行描述。
  2. 在确保测试通过的情况下，对代码做尽量少的修改。
  3. 对代码进行改进（重构），并再次运行测试，确保代码依然能够正确地运行。